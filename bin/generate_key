#!/usr/bin/env ruby
require 'thor/group'
require 'rsa'
require 'yaml'

class Generator < Thor::Group
  include Thor::Actions

  argument :bits, :type => :numeric, :default => 1024

  def setup
    self.destination_root = File.expand_path("../etc", File.dirname(__FILE__))
  end

  def generate
    puts __FILE__
    print "If this is slow, generate some randomness... "
    @key_pair = RSA::KeyPair.generate(bits)
    puts "done."
  end

  def save
    create_file("identity.yml", @key_pair.to_yaml)
  end
end

Generator.start
